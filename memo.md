âœ… MABe / MACB EDA ã¾ã¨ã‚ï¼ˆMarkdownç‰ˆï¼‰

ä»¥ä¸‹ãã®ã¾ã¾ã‚³ãƒ”ãƒšã§ãã¾ã™ã€‚

â¸»

# MABe EDA ã®æ°—ã¥ãã¾ã¨ã‚

## 1. train.csvï¼ˆãƒ¡ã‚¿æƒ…å ±ï¼‰
	â€¢	8789è¡Œ Ã— 38åˆ— ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€‚
	â€¢	ä¸»ãªã‚«ãƒ©ãƒ ï¼š

```sh
lab_id, video_id,
mouse1_strain, mouse1_color, mouse1_sex, mouse1_id, mouse1_age, mouse1_condition,
mouse2_*, mouse3_*, mouse4_*,
frames_per_second, video_duration_sec,
pix_per_cm_approx,
video_width_pix, video_height_pix,
arena_width_cm, arena_height_cm, arena_shape, arena_type,
body_parts_tracked, behaviors_labeled, tracking_method
```
	â€¢	mouse1ã€œmouse4 ã¯ãã‚Œãã‚Œã®ãƒã‚¦ã‚¹ã®å±æ€§æƒ…å ±ã€‚
å‹•ç”»å†…ã®ãƒã‚¦ã‚¹æ•°ãŒ2åŒ¹ã®ã¨ãã¯ mouse3, mouse4 ã¯ NaNã€‚

### Labï¼ˆç ”ç©¶å®¤ï¼‰é–“ã®é•ã„
	â€¢	lab_id ã«ã‚ˆã£ã¦
	â€¢	FPS
	â€¢	è§£åƒåº¦
	â€¢	ã‚¢ãƒªãƒ¼ãƒŠã®å½¢çŠ¶
	â€¢	tracking method
	â€¢	behaviors_labeledï¼ˆãƒ©ãƒ™ãƒ«ã®ç¨®é¡ï¼‰
ãŒå¤§ããç•°ãªã‚‹ã€‚

### ãƒ©ãƒ™ãƒ«ï¼ˆannotationï¼‰ãŒä»˜ã„ã¦ã„ã‚‹å‹•ç”»æ•°
	â€¢	train_dataframe.filter(pl.col("behaviors_labeled").is_null()).shape â†’ 7941/8789 â†’ ãƒ©ãƒ™ãƒ«ãªã—
	â€¢	train_dataframe.filter(pl.col("behaviors_labeled").is_not_null()).shape â†’ 848/8789 â†’ ãƒ©ãƒ™ãƒ«ã‚ã‚Š
â†’ å…¨å‹•ç”»ã®ç´„ 9.6% ã—ã‹ãƒ©ãƒ™ãƒ«ä»˜ãã§ã¯ãªã„ã€‚

â¸»

## 2. test.csv
	â€¢	ãƒ¡ã‚¿æƒ…å ±ã®ã¿ï¼ˆtrain ã¨ã»ã¼åŒã˜38åˆ—ï¼‰
	â€¢	è¡Œå‹•ãƒ©ãƒ™ãƒ«ã¯å…¥ã£ã¦ã„ãªã„ã€‚

â¸»

## 3. sample_submission.csv

Kaggleæå‡ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆ7åˆ—ï¼‰ï¼š
```sh
row_id, video_id, agent_id, target_id, action, start_frame, stop_frame
```

## 4. train_trackingï¼ˆåº§æ¨™ãƒ‡ãƒ¼ã‚¿ï¼‰
	â€¢	å„ video_id ã«å¯¾ã—ã¦ 1ã¤ã® parquet
	â€¢	å†…å®¹ï¼š
video_frame, mouse_id, bodypart, x, y

	â€¢	pivot ã‚’ã‹ã‘ã‚‹ã¨ã€ã€Œ1ãƒ•ãƒ¬ãƒ¼ãƒ  = 1è¡Œã§å…¨ãƒã‚¦ã‚¹Ã—å…¨bodypart ã®åº§æ¨™ã€ã‚’æŒã¦ã‚‹ã€‚

ä¾‹ï¼ˆwideãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰ï¼š
```sh
mouse1_nose_x, mouse1_nose_y, mouse2_body_center_x, ...
```

## 5. train_annotationï¼ˆè¡Œå‹•ãƒ©ãƒ™ãƒ«åŒºé–“ï¼‰
	â€¢	848ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ©ãƒ™ãƒ«ãŒã‚ã‚‹å‹•ç”»ã®ã¿ï¼‰
	â€¢	å„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®å½¢å¼ï¼š
```sh
agent_id, target_id, action, start_frame, stop_frame
```

# ã“ã“ã‹ã‚‰ã¯ã€Œã“ã‚Œã¾ã§ã®EDAã§å¾—ã‚‰ã‚ŒãŸé‡è¦ãªçŸ¥è¦‹ã¾ã¨ã‚ã€

## 6. è¡Œå‹•é »åº¦ï¼ˆclass imbalanceï¼‰
	â€¢	sniff ãŒ ç´„40,000ä»¶ã§åœ§å€’çš„å¤šæ•°ã€‚
	â€¢	ejaculate, biteobject ãªã© rare class ã¯æ•°åã€œæ•°ç™¾ä»¶ãƒ¬ãƒ™ãƒ«ã€‚
	â€¢	å…¸å‹çš„ãª è¶…ãƒ»é•·ã„ãƒ†ãƒ¼ãƒ«å•é¡Œã€‚

### ãƒ¢ãƒ‡ãƒ«ã¸ã®å½±éŸ¿
	â€¢	ä½•ã‚‚ã—ãªã„ã¨ãƒ¢ãƒ‡ãƒ«ã¯ sniff ã ã‘äºˆæ¸¬ã—ã¦é«˜ã„ç²¾åº¦ã‚’å–ã‚Œã¦ã—ã¾ã†ã€‚
	â€¢	rare ã‚¯ãƒ©ã‚¹ã¯ã»ã¼äºˆæ¸¬ã•ã‚Œãªã„ã€‚

### å¿…é ˆã®å¯¾ç­–
	â€¢	class-weighted loss
	â€¢	focal loss
	â€¢	rare class oversampling
	â€¢	F-score ç³»ã®è©•ä¾¡æŒ‡æ¨™

â¸»

## 7. è¡Œå‹• durationï¼ˆæŒç¶šæ™‚é–“ï¼‰
	â€¢	duration ã« **äºŒå³°æ€§ï¼ˆãƒã‚¤ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰**ãŒã‚ã‚‹
	â€¢	çŸ­ã„è¡Œå‹•ã®ãƒ”ãƒ¼ã‚¯ï¼ˆ10ã€œ30 framesï¼‰
	â€¢	é•·ã„è¡Œå‹•ã®ãƒ”ãƒ¼ã‚¯ï¼ˆ30ã€œ200 framesï¼‰

### è¡Œå‹•åˆ¥ã®Durationç‰¹å¾´
	â€¢	flinch, sniffbody â†’ è¶…çŸ­ã„ï¼ˆä¸­å¤®å€¤ < 10 framesï¼‰
	â€¢	rest, intromit, ejaculate â†’ é•·ã„
	â€¢	å¤šãã®è¡Œå‹•ã«ã€Œé•·ã„å°»å°¾ï¼ˆheavy tailï¼‰ã€ãŒå­˜åœ¨ã™ã‚‹ã€‚

### ç¤ºå”†
	â€¢	ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ã¯ 64ã€œ256 frames ã§ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã¹ã
	â€¢	ãƒ¢ãƒ‡ãƒ«ã¯çŸ­æœŸã‚¤ãƒ™ãƒ³ãƒˆã¨é•·æœŸã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¡æ–¹ã«ãƒ­ãƒã‚¹ãƒˆã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹

â¸»

## 8. Labé–“ã®åˆ†å¸ƒå·®ï¼ˆResearch Lab Bias / Domain Shiftï¼‰
	â€¢	ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚ˆã‚Šã€è¡Œå‹•ãƒ©ãƒ™ãƒ«åˆ†å¸ƒã¯ Lab ã”ã¨ã«å¤§å¹…ã«ç•°ãªã‚‹ã€‚
	â€¢	rare è¡Œå‹•ãŒç‰¹å®šLabã«ã—ã‹å­˜åœ¨ã—ãªã„ä¾‹ã‚‚ã‚ã‚Šã€‚

### ç¤ºå”†ï¼ˆéå¸¸ã«é‡è¦ï¼‰
	â€¢	CV ã¯å¿…ãš GroupKFold(lab_id) ã§åˆ†å‰²ã™ã‚‹ã“ã¨ï¼
	â€¢	ã§ãªã„ã¨ã€ŒåŒã˜ Lab ã®å‹•ç”»ã€ãŒ train/valid ã«æ··ã–ã£ã¦ã—ã¾ã„
â†’ æœªçŸ¥ãƒ©ãƒœã¸ã®æ±åŒ–æ€§èƒ½ãŒå…¨ãæ¸¬ã‚Œãªã„
	â€¢	lab_id ã‚’ç‰¹å¾´é‡ã«åŠ ãˆã‚‹ã‹ã©ã†ã‹ã¯å¾Œã§æ¤œè¨¼ï¼ˆå…¥ã‚Œã™ãã‚‹ã¨éé©åˆã®å±é™ºã‚‚ï¼‰

â¸»

## 9. Multi-Mouse Interactionï¼ˆè¡Œå‹•ã¯ãƒã‚¦ã‚¹é–“ã®ç›¸äº’ä½œç”¨ã§æ±ºã¾ã‚‹ï¼‰
	â€¢	sniff / chase / attack / rear ã¯ã„ãšã‚Œã‚‚
agent ã¨ target ã®ç›¸å¯¾è·é›¢ãƒ»ç›¸å¯¾é€Ÿåº¦ãƒ»ç›¸å¯¾è§’åº¦ ã§æ±ºã¾ã‚‹ã€‚
	â€¢	ã‚ˆã£ã¦ç‰¹å¾´é‡ã¨ã—ã¦ï¼š
```sh
distance(agent, target)
relative_velocity
agent_heading
angle(agent â†’ target)
wall_distance
```
ãªã©ãŒéå¸¸ã«åŠ¹ãã€‚

â¸»

## 10. åº§æ¨™ç³»ã®æ­£è¦åŒ–ï¼ˆNFL ã§ã‚‚åŠ¹ã„ãŸæ‰‹æ³•ï¼‰
	â€¢	å„ãƒ•ãƒ¬ãƒ¼ãƒ ã§ agent ã‚’åŸç‚¹ (0,0) ã«å¹³è¡Œç§»å‹•ã—ã€
	â€¢	agentâ†’target ã®æ–¹å‘ã‚’ +xè»¸ã«å›è»¢ã•ã›ã‚‹ã¨ï¼š

è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæƒã„ã€å­¦ç¿’ãŒå®¹æ˜“ã«ãªã‚‹ã€‚

â¸»

## 11. Transformer ã«è·é›¢ãƒã‚¤ã‚¢ã‚¹ï¼ˆDynamic Position Biasï¼‰ãŒåŠ¹ã

NFLã‚³ãƒ³ãƒšã§è­°è«–ã•ã‚Œã¦ã„ãŸã€Œdistance-based attention biasã€ã¯
MABe ã® multi-mouse ã§ ã•ã‚‰ã«æœ¬è³ªçš„ã«åŠ¹ãã€‚

### å®Ÿè£…ä¾‹
bias_mouse = -Î± * distance_matrix  # M x M
attention_scores += bias_mouse

â†’ è¿‘ã„ãƒã‚¦ã‚¹åŒå£«ã®ç›¸äº’ä½œç”¨ã‚’å¼·ãè¦‹ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

â¸»

## 12. Augmentation

MABe ã¯åº§æ¨™ãƒ™ãƒ¼ã‚¹ãªã®ã§ã€ä»¥ä¸‹ã® aug ãŒæœ‰åŠ¹ï¼š
	â€¢	x/y è»¸Flipï¼ˆä¸Šä¸‹å·¦å³ï¼‰
	â€¢	å°‘ã—ã®å¹³è¡Œç§»å‹•
	â€¢	æ™‚é–“æ–¹å‘ã®éƒ¨åˆ†åˆ‡ã‚Šå‡ºã— / shift
	â€¢	åº§æ¨™ãƒã‚¤ã‚º + å°å›è»¢

â€» ãƒ©ãƒ™ãƒ«ã¯å¤‰åŒ–ã—ãªã„ã®ã§å®‰å…¨ã€‚

â¸»

# æœ€çµ‚ã¾ã¨ã‚ï¼šMABeã§é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

ğŸ¯ 1. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
	â€¢	train.csv ã¯ãƒ¡ã‚¿æƒ…å ±
	â€¢	å®Ÿéš›ã®å­¦ç¿’ã¯ tracking + annotation ã® parquet ã‚’ä½¿ã†

ğŸ¯ 2. ãƒ©ãƒ™ãƒ«ä»˜ãå‹•ç”»ã¯å…¨ä½“ã® 9.6%ï¼ˆ848æœ¬ï¼‰ã—ã‹ãªã„

â†’ ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µãƒ»ç‰¹å¾´é‡è¨­è¨ˆãŒéå¸¸ã«é‡è¦

ğŸ¯ 3. è¶…ä¸å‡è¡¡ãƒ‡ãƒ¼ã‚¿

â†’ class weight / focal loss / oversampling ã¯å¿…é ˆ

ğŸ¯ 4. Labã”ã¨ã®åˆ†å¸ƒå·®ãŒã¨ã¦ã‚‚å¤§ãã„

â†’ GroupKFold(lab_id) ä»¥å¤–ã¯å±é™º
â†’ lab_id ã‚’ç‰¹å¾´é‡ã«å…¥ã‚Œã‚‹ã®ã¯å¾Œã§å®Ÿé¨“

ğŸ¯ 5. è¡Œå‹•ã¯ multi-agent ã§æ±ºã¾ã‚‹

â†’ ç›¸å¯¾è·é›¢ãƒ»ç›¸å¯¾è§’åº¦ãƒ»æ¥è¿‘é€Ÿåº¦ã‚’çµ¶å¯¾ã«å…¥ã‚Œã‚‹ã¹ã

ğŸ¯ 6. duration ãŒäºŒå³°æ€§

â†’ çŸ­æœŸã‚¤ãƒ™ãƒ³ãƒˆã¨é•·æœŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¸¡æ–¹æ‰±ãˆã‚‹ãƒ¢ãƒ‡ãƒ«ãŒå¿…è¦
â†’ Sequence length ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°é‡è¦

ğŸ¯ 7. NFLã§åŠ¹ã„ãŸâ€œè·é›¢ãƒã‚¤ã‚¢ã‚¹Attentionâ€ã¯MABeã§ç‰¹ã«åŠ¹ã

â†’ mouse-attention ã«è·é›¢è¡Œåˆ—ã‚’åˆ©ç”¨ã™ã‚Œã°
ã€€ è¡Œå‹•èªè­˜ã®æœ¬è³ªã‚’ãƒ¢ãƒ‡ãƒ«ã«ç›´æ¥åŸ‹ã‚è¾¼ã‚ã‚‹